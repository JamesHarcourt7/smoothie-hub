<html>
    
    <head>
            <link rel="stylesheet" href="styles.css">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
            <title>Smoothie Hub</title>
    </head>
    <body>
        <header>
            <h1>Smoothie Hub
                <span><button class=optionshite id=home-login-button onclick="goToLogin()">Login</button></span>
                <span><button class=optionshite id=home-profile-button onclick="goToProfile()">Profile</button></span>
                <span><button class=optionshite id=home-create-button onclick="goToCreatePost()">Create Post</button></span>
                <span><button class=optionshite id=home-logout-button onclick="logout()">Log Out</button></span>
                <script>
                    function goToProfile() {
                        var iKnowIDefineItLaterButJSIsStupidAndIDontLikeIt = document.cookie.split("=")[1]
                        if (iKnowIDefineItLaterButJSIsStupidAndIDontLikeIt != "") {
                            window.location.href="/profile?" + iKnowIDefineItLaterButJSIsStupidAndIDontLikeIt
                        }
                    }
                    function goToCreatePost() {
                        window.location.href="/createpost.html"
                    }
                    function goToLogin() {
                        window.location.href="/login.html"
                    }
                    function logout() {
                        document.cookie = "username="
                        window.location.href = "/home.html"
                    }
                    var user = document.cookie.split("=")[1]
                    if (user == "") {
                        document.getElementById("home-profile-button").style.display = "none";
                        document.getElementById("home-create-button").style.display = "none";
                        document.getElementById("home-logout-button").style.display = "none";
                    } else {
                        document.getElementById("home-login-button").style.display = "none";
                    }

                </script>
            </h1>
            
        </header>
        
        <div class="flex-container">
            <div id = image-holder><img src="" id=main-smoothie-image></div>
            <span id = separator></span>
            <div class=post>
                <h2 id=title-text></h2>
                <p>
                    <img src="" id=pfp>
                    <a id=user-link href=""><span id=username-text></span></a>
                </p>
                
                <div>
                    <span class=stars id=1><i class="fa fa-star"></i></span>
                    <span class=stars id=2><i class="fa fa-star"></i></span>
                    <span class=stars id=3><i class="fa fa-star"></i></span>
                    <span class=stars id=4><i class="fa fa-star"></i></span>
                    <span class=stars id=5><i class="fa fa-star"></i></span>
                </div>

                <h3>Description:</h3>
                <p id = description-text></p>

                <h3>Ingredients:</h3>
                <p id=list></p>

                <button class=optionshite id=like-button onclick="like()">Like</button>
                <button class=optionshite id=dislike-button onclick="dislike()">Dislike</button>

                <script>
                    var user = document.cookie.split("=")[1]
                    if (user == "") {
                        document.getElementById("like-button").style.display = "none";
                        document.getElementById("dislike-button").style.display = "none";
                    }
                </script>

                <label id=post-id hidden=true></label>

                <script>
                    function like() {
                        var id = document.getElementById("post-id").innerHTML
                        if (id == "") return;
                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/rate_post/" + id + "/5", false);
                        xhReq.send(null);
                        var serverResponse = xhReq.responseText;
                        updateRatings(id);

                    }
                    function dislike() {
                        var id = document.getElementById("post-id").innerHTML
                        var username = document.cookie.split("=")[1]
                        if (id == "") return;
                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/rate_post/" + id + "/0/" + username, false);
                        xhReq.send(null);
                        var serverResponse = xhReq.responseText;
                        updateRatings(id);
                    }
                    function updateRatings(id) {
                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/GetRatingFromPost/" + id, false);
                        xhReq.send(null);
                        var serverResponse = xhReq.responseText;
                        var rating = serverResponse;
                        
                        for (i=1; i <= 5; i++) {
                            document.getElementById(i).style.cssText = "background-color: white"
                        }
                        for (i=1; i <= rating; i++) {
                            document.getElementById(i).style.cssText = "background-color: gold;"
                        }
                        if (rating >= 5) {
                            return
                        }
                        var r = (rating % 1) * 100
                        document.getElementById(Math.floor(rating + 1)).style.cssText = "background-color: linear-gradient(to right,  gold " + r.toString() + "%, white " + (1 - r).toString() + "%);"
                    }
                </script>

                <script>
                    function ajax() {
                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/SuggestNextPost", false);
                        xhReq.send(null);
                        var id = xhReq.responseText;

                        document.getElementById("post-id").innerHTML = id;

                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/GetTitleFromPost/" + id, false);
                        xhReq.send(null);
                        var serverResponse = xhReq.responseText;
                        document.getElementById("title-text").innerHTML = serverResponse;

                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/GetUserFromPost/" + id, false);
                        xhReq.send(null);
                        var serverResponse = xhReq.responseText;
                        var usernameFromServer = serverResponse;
                        document.getElementById("username-text").innerHTML = usernameFromServer;
                        document.getElementById("user-link").href = "/profile?" + usernameFromServer;

                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/GetDescFromPost/" + id, false);
                        xhReq.send(null);
                        var serverResponse = xhReq.responseText;
                        document.getElementById("description-text").innerHTML = serverResponse;
                    
                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/GetIngrFromPost/" + id, false);
                        xhReq.send(null);
                        var serverResponse = xhReq.responseText;
                        document.getElementById("list").innerHTML = serverResponse;

                        document.getElementById("main-smoothie-image").src = "/GetImageFromPost/" + id;
                        document.getElementById("pfp").src = "/GetPFP/" + usernameFromServer;

                        var xhReq = new XMLHttpRequest();
                        xhReq.open("GET", "/GetRatingFromPost/" + id, false);
                        xhReq.send(null);
                        var serverResponse = xhReq.responseText;
                        var rating = serverResponse;
                        for (i=1; i <= rating; i++) {
                            document.getElementById(i).style.cssText = "background-color: gold;"
                        }
                        var r = (rating % 1) * 100
                        if (rating >= 5) {
                            return
                        }
                        document.getElementById(Math.floor(rating + 1)).style.cssText = "background-color: linear-gradient(to right,  gold " + r.toString() + "%, white " + (1 - r).toString() + "%);"

                    }
                    ajax()

                </script>

            </div>
        </div>
                    
    </body>
</html>